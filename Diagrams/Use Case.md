# Диаграмма вариантов использования

![Диаграмма вариантов использования](https://github.com/Anton-Euro/gnotebin-lab/blob/main/Diagrams/Images/diag_use_case.png?raw=true)

# Глоссарий

| Термин | Определение |
|:---|:---|
| Пользователь | Основной и единственный актор-человек, использующий приложение для управления файлами и заметками. |
| Drive | Раздел приложения для управления файлами. |
| Pin (Заметка) | Раздел приложения для управления текстовыми заметками. |
| S3 Хранилище | Внешний сервис (объектное хранилище), где физически хранятся загруженные файлы. |
| База данных | Внешний сервис для хранения метаданных о файлах и текста заметок. |
| CID | Content Identifier. Уникальный идентификатор контента в системе IPFS, используемый Filebase. |
| Slug | Уникальный человекочитаемый идентификатор, используемый в URL для доступа к заметке. |

# Поток событий

# Содержание
1 [Актёры](#actors)  
2 [Варианты использования](#use_case)  
2.1 [Аутентификация администратора](#authentication)  
2.2 [Просмотр списка файлов и пинов](#view_list)  
2.3 [Загрузка файла](#upload_file)  
2.4 [Предпросмотр файла](#preview_file)  
2.5 [Скачивание файла](#download_file)  
2.6 [Удаление файла](#delete_file)  
2.7 [Создание заметки (Pin)](#create_pin)  
2.8 [Просмотр заметки](#view_pin)  
2.9 [Скачивание заметки](#download_pin)  
2.10 [Удаление заметки](#delete_pin)  

<a name="actors"/>

# 1 Актёры

| Актёр | Описание |
|:---|:---|
| Пользователь | Человек, использующий приложение для хранения файлов и создания заметок. |
| Хранилище S3 | Внешняя система (объектное хранилище), отвечающая за физическое хранение, выдачу и удаление файлов. |
| База данных | Внешняя система, отвечающая за хранение метаданных о файлах и содержания текстовых заметок. |

<a name="use_case"/>

# 2 Варианты использования

<a name="authentication"/>

## 2.1 Аутентификация администратора

**Описание.** Вариант использования позволяет пользователю получить доступ к защищенному разделу Drive.  
**Предусловия.** Пользователь пытается получить доступ к странице `/drive/`.  
**Основной поток.**
1.  Приложение отображает форму для ввода пароля;
2.  Пользователь вводит пароль и нажимает кнопку "Sign in";
3.  Приложение проверяет соответствие пароля заданному в конфигурации;
4.  Приложение предоставляет доступ к странице Drive;
5.  Вариант использования завершается.

**Альтернативный поток А1 (Неверный пароль).**
1.  На шаге 3 основного потока приложение определяет, что пароль неверный;
2.  Приложение создает сессионное сообщение об ошибке;
3.  Приложение перенаправляет пользователя на страницу `/login/` и отображает сообщение об ошибке;
4.  Вариант использования завершается досрочно.

**Постусловия.** Выполняется вариант использования "[2.2 Просмотр списка файлов и пинов](#view_list)".

<a name="view_list"/>

## 2.2 Просмотр списка файлов и пинов

**Описание.** Вариант использования загружает и отображает пользователю списки его файлов и заметок.  
**Предусловия.** Пользователь успешно прошел аутентификацию.  
**Основной поток.**
1.  Приложение запрашивает у Базы данных список всех файлов и заметок;
2.  Приложение запрашивает у Хранилища S3 метаданные (включая размеры) для всех файлов;
3.  Приложение отображает полученные данные в виде таблиц на вкладках "Drive" и "Pins";
4.  Вариант использования завершается.

**Альтернативный поток А1 (Список пуст).**
1.  На шаге 3 основного потока приложение не получает данных;
2.  Приложение отображает пустые таблицы;
3.  Вариант использования завершается.

<a name="upload_file"/>

## 2.3 Загрузка файла

**Описание.** Вариант использования позволяет пользователю загрузить файл в хранилище.  
**Предусловия.** Пользователь аутентифицирован и находится на вкладке "Drive".  
**Основной поток.**
1.  Пользователь выбирает файл на своем устройстве и нажимает кнопку "upload";
2.  Приложение генерирует для файла уникальный ID;
3.  Приложение инициирует потоковую загрузку файла в Хранилище S3;
4.  Хранилище S3 успешно принимает файл;
5.  Приложение запрашивает у S3 метаданные объекта, включая CID;
6.  Приложение сохраняет запись о файле (ID, имя, CID, дата) в Базу данных;
7.  Приложение информирует пользователя об успешном завершении загрузки;
8.  Вариант использования завершается.

**Альтернативный поток А1 (Файл с таким именем уже существует).**
1.  Перед шагом 3 основного потока приложение проверяет по Базе данных наличие файла с таким именем;
2.  Приложение генерирует новое имя файла, добавляя к нему суффикс (например, `file(1).txt`);
3.  Основной поток продолжается с шага 3, используя новое имя.

**Поток ошибки Е1 (Ошибка при загрузке в S3).**
1.  Во время выполнения шага 3 или 4 Хранилище S3 возвращает ошибку;
2.  Приложение прерывает загрузку и сообщает пользователю об ошибке;
3.  Вариант использования завершается.

**Постусловия.** После перезагрузки страницы пользователь видит новый файл в списке.

<a name="preview_file"/>

## 2.4 Предпросмотр файла

**Описание.** Отображает содержимое файла, если его тип поддерживается.  
**Предусловия.** Пользователь аутентифицирован и нажимает на иконку "preview" для существующего файла.  
**Основной поток.**
1.  Приложение запрашивает у Базы данных запись о файле по его ID;
2.  Приложение определяет тип файла по его расширению;
3.  Приложение запрашивает содержимое файла из Хранилища S3;
4.  Приложение отображает страницу предпросмотра с содержимым файла (форматированный код, изображение и т.д.);
5.  Вариант использования завершается.

<a name="download_file"/>

## 2.5 Скачивание файла

**Описание.** Позволяет пользователю скачать оригинальный файл.  
**Предусловия.** Пользователь аутентифицирован и нажимает на иконку "download" для существующего файла.  
**Основной поток.**
1.  Приложение предоставляет пользователю прямую ссылку на скачивание файла из IPFS-шлюза;
2.  Браузер пользователя начинает скачивание файла;
3.  Вариант использования завершается.

<a name="delete_file"/>

## 2.6 Удаление файла

**Описание.** Позволяет пользователю удалить файл из хранилища.  
**Предусловия.** Пользователь аутентифицирован и нажимает на иконку "delete" для существующего файла.  
**Основной поток.**
1.  Приложение получает запрос на удаление с ID файла и секретным ключом;
2.  Приложение проверяет валидность ключа;
3.  Приложение отправляет команду в Хранилище S3 на удаление объекта;
4.  Приложение отправляет команду в Базу данных на удаление записи о файле;
5.  Приложение возвращает успешный ответ, и интерфейс обновляется;
6.  Вариант использования завершается.

<a name="create_pin"/>

## 2.7 Создание заметки (Pin)

**Описание.** Позволяет пользователю создать новую текстовую заметку.  
**Предусловия.** Пользователь находится на странице создания заметки (`/pin/create/`).  
**Основной поток.**
1.  Пользователь вводит текст в поле и нажимает кнопку "Create";
2.  Приложение проверяет, что текст не пустой;
3.  Приложение генерирует уникальный slug (например, `word-one-two`);
4.  Приложение сохраняет текст и slug заметки в Базу данных;
5.  Приложение перенаправляет пользователя на страницу просмотра созданной заметки;
6.  Вариант использования завершается.

**Альтернативный поток А1 (Текст пуст).**
1.  На шаге 2 основного потока приложение определяет, что поле для ввода текста пустое;
2.  Приложение перезагружает страницу создания, не сохраняя заметку;
3.  Вариант использования завершается досрочно.

<a name="view_pin"/>

## 2.8 Просмотр заметки

**Описание.** Отображает содержимое ранее созданной заметки.  
**Предусловия.** Пользователь переходит по URL существующей заметки.  
**Основной поток.**
1.  Приложение извлекает из Базы данных текст заметки по её slug из URL;
2.  Приложение отображает страницу с текстом заметки и её метаданными;
3.  Вариант использования завершается.

<a name="download_pin"/>

## 2.9 Скачивание заметки

**Описание.** Позволяет пользователю скачать заметку в виде текстового файла.  
**Предусловия.** Пользователь находится на странице просмотра заметки и нажимает "download".  
**Основной поток.**
1.  Приложение извлекает текст заметки из Базы данных;
2.  Приложение формирует в памяти `.txt` файл;
3.  Приложение отдает файл браузеру для скачивания;
4.  Вариант использования завершается.

<a name="delete_pin"/>

## 2.10 Удаление заметки

**Описание.** Позволяет пользователю удалить заметку.  
**Предусловия.** Пользователь аутентифицирован, находится на вкладке "Pins" и нажимает на иконку "delete".  
**Основной поток.**
1.  Приложение получает запрос на удаление со slug заметки и секретным ключом;
2.  Приложение проверяет валидность ключа;
3.  Приложение отправляет команду в Базу данных на удаление записи о заметке;
4.  Приложение возвращает успешный ответ, и интерфейс обновляется;
5.  Вариант использования завершается.